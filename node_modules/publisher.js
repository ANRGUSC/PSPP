const mqtt = require('mqtt');
var topic = "Hola-0"; var topic1 = "Hola-1"; var topic2 = "Hola-2"

var client = mqtt.connect('mqtt://localhost', {
         clientId: `1`,
         clean: false,
     })

//Three messages, one publisher, one topic
const userMessagePerSecond = 10;
const userMessageInterval = 1000 / userMessagePerSecond;
var messageNumber = 1;

client.on('connect', function(){
    setInterval(function(){
        var message = `${messageNumber}th message`;
        client.publish(topic, message, {
            qos: 0,
            retain: false,
            price: 1,
            currency: 'bla-bla'
        })
        messageNumber++
    }, userMessageInterval)     
})


var  subs = mqtt.connect('mqtt://localhost', {
         clientId: `subs-1`,
         clean: false
     })

     subs.on('connect', function () {
        subs.subscribe(topic);
        console.log(`user subs-1 subscribed to group topic ${topic}`)
     })

     subs.on('packetreceive', function(packetreceive){
         console.log(`This is the price for: ${packetreceive.topic} `,packetreceive.price)
         console.log('This is the topic: ',packetreceive.topic)
     })

var bal = 10;
var  subs1 = mqtt.connect('mqtt://localhost', {
        clientId: `subs-2`,
        clean: false
    })

    subs1.on('connect', function () {
       subs1.subscribe(topic);
       console.log(`user subs-2 subscribed to group topic ${topic}`)
       subs1.subscribe(topic1);
       console.log(`user subs-2 subscribed to group topic ${topic1}`)
    })

var  subs2 = mqtt.connect('mqtt://localhost', {
        clientId: `subs-3`,
        clean: false
    })

    subs2.on('connect', function () {
       subs2.subscribe(topic1);
       console.log(`user subs-3 subscribed to group topic ${topic1}`)
    })